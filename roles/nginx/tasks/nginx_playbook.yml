---
  - name: Role to install nginx
    hosts: linux

    tasks:
      - name: Updating centos.repo file
        copy:
          src: /app/ansible_poc/roles/nginx/files/centos.repo
          dest: /etc/yum.repos.d/centos.repo
#        when: ansible_hostname == "ansiblehost" || ansible_hostname == "ansibleclient"

      - name: Installing EPEL repo
        yum:
          name: epel-release
          update_cache: yes
          state: latest
        when: ansible_hostname == "nodemanager"

      - name: Installing patch utility on machines
        yum:
          name: patch
          update_cache: yes
          state: latest
        when: ansible_hostname == "nodemanager"

      - name: Creates a directory to place nginx html files
        file:
          path: /app/nginx/html
          recurse: yes
          state: directory
      
      - name: Changing Default configuration of nginx
        copy:
          src: /app/ansible_poc/roles/nginx/files/nginx_default.conf
          dest: /etc/nginx/nginx.conf


      - name: Setting up firewall to run nginx
        firewalld:
          service: http
          permanent: yes
          state: enabled
        notify: Firewalld services restarted
   
      - name: Setting up firewall to run nginx
        firewalld:
          port: 8080/tcp
          permanent: yes
          state: enabled
        notify: Firewalld services restarted

      - name: Creating welcome page for nginx service
        template:
          src: /app/ansible_poc/roles/nginx/templates/index.html.j2
          dest: /app/nginx/html/index.html
          mode: 0644

      - name: Installing Nginx service
        package:
          name: nginx
          state: latest
      
      - name: Restart nginx
        service:
          name: nginx
          state: restarted
        notify: Check HTTP Service

    handlers:
      - name: Check HTTP Service
        uri:
          url: http://{{ ansible_default_ipv4.address }}:8080
          status_code: 200
   
      - name: Firewalld services restarted
        service:
          name: firewalld
          state: reloaded




...

